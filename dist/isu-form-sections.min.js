function formatHttp(){return{restrict:"A",require:"ngModel",link:function(e,t,n,i){function o(e){return e&&!/^(https?):\/\//i.test(e)&&-1==="http://".indexOf(e)?(i.$setViewValue("http://"+e),i.$render(),"http://"+e):e}i.$formatters.push(o),i.$parsers.splice(0,0,o)}}}function textSection(e){"use strict";var t=e.startSymbol(),n=e.endSymbol();return{replace:!0,template:['<section style="order:'+t+"sections[$sIndex].order"+n+'" id="object-'+t+"sections[$sIndex].order"+n+'">',"<md-toolbar>","<header>Text Section</header>",'<a class="mdi button mdi-chevron-up" ng-click="create.move(sections[$sIndex].order, false)"></a>','<a class="mdi button mdi-chevron-down" ng-click="create.move(sections[$sIndex].order, true)"></a>','<a class="mdi button mdi-close" ng-click="create.remove(sections[$sIndex].order)"></a>',"</md-toolbar>","<fieldset>",'<text-angular ng-model="sections[$sIndex].content.text"></text-angular>',"</fieldset>","</section>"].join("")}}function inlineImageSection(e){"use strict";var t=e.startSymbol(),n=e.endSymbol();return{replace:!0,controller:["$scope",function(e){e.imageFields=[0],e.addImage=function(t){var n=e.imageFields.length+1;e.imageFields.push(n)},e.removeImage=function(t,n){e.$parent.sections[e.$sIndex].content=e.$parent.sections[e.$sIndex].content.map(function(i){return i.file_id===t?void e.imageFields.splice(n,1):i}).filter(function(e){return!angular.isUndefined(e)})}}],link:function(e,t,n){var i=null,o=e.$watch(function(){if(e.$parent.sections[e.$sIndex]&&e.$parent.sections[e.$sIndex].content&&i!==e.$parent.sections[e.$sIndex].content.length){i=e.$parent.sections[e.$sIndex].content.length;for(var t=1;i>t;t++)e.imageFields.push(t);o()}})},template:['<section style="order:'+t+"sections[$sIndex].order"+n+'" id="object-'+t+"sections[$sIndex].order"+n+'">',"<md-toolbar>","<header>Inline Image Section</header>",'<a class="mdi button mdi-chevron-up" ng-click="create.move(sections[$sIndex].order, false)"></a>','<a class="mdi button mdi-chevron-down" ng-click="create.move(sections[$sIndex].order, true)"></a>','<a class="mdi button mdi-close" ng-click="create.remove(sections[$sIndex].order)"></a>',"</md-toolbar>",'<fieldset ng-repeat="(rIndex, r) in imageFields">','<span ng-if="sections[$sIndex].content[rIndex].file_id">','<a class="mdi button mdi-close" ng-click="removeImage(sections[$sIndex].content[rIndex].file_id, rIndex)"></a>','<img ng-src="/storage/app/'+t+"sections[$sIndex].content[rIndex].image.filename"+n+'"/>',"</span>",'<input class="md-button" type="file" name="sections['+t+"$sIndex"+n+"].content["+t+"rIndex"+n+'].image.file" ng-model="sections[$sIndex].content[rIndex].image.file"/>',"<md-input-container>","<label>Description</label>",'<input type="text" ng-model="sections[$sIndex].content[rIndex].image.description"/>',"</md-input-container>","<md-input-container>","<label>URL</label>",'<input type="url" ng-model="sections[$sIndex].content[rIndex].url" format-http/>',"</md-input-container>","</fieldset>",'<a class="mdi button mdi-plus" ng-click="addImage()"></a>',"</section>"].join("")}}function profileSection(e){"use strict";var t=e.startSymbol(),n=e.endSymbol();return{replace:!0,link:function(e,t,n){e.$watch(function(){if("undefined"!=typeof e.$parent.sections[e.$sIndex]){var t=e.$parent.sections[e.$sIndex].content;t&&t.hasOwnProperty("image")&&t.hasOwnProperty("heading")&&(t.image.description=t.heading+(t.subheading?" - "+t.subheading:""))}},!0)},template:['<section style="order:'+t+"sections[$sIndex].order"+n+'" id="object-'+t+"sections[$sIndex].order"+n+'">',"<md-toolbar>","<header>Profile Section</header>",'<a class="mdi button mdi-chevron-up" ng-click="create.move(sections[$sIndex].order, false)"></a>','<a class="mdi button mdi-chevron-down" ng-click="create.move(sections[$sIndex].order, true)"></a>','<a class="mdi button mdi-close" ng-click="create.remove(sections[$sIndex].order)"></a>',"</md-toolbar>","<fieldset>",'<span ng-if="sections[$sIndex].content.file_id">','<img ng-src="/storage/app/'+t+"sections[$sIndex].image.filename"+n+'"/>',"</span>",'<input class="md-button" type="file" name="sections['+t+"$sIndex"+n+'].content.image.file" ng-model="sections[$sIndex].content.image.file"/>',"<md-input-container>","<label>Heading</label>",'<input type="text" ng-model="sections[$sIndex].content.heading"/>',"</md-input-container>","<md-input-container>","<label>Subheading</label>",'<input type="text" ng-model="sections[$sIndex].content.subheading"/>',"</md-input-container>",'<text-angular ng-model="sections[$sIndex].content.text"></text-angular>','<input type="hidden" ng-model="sections[$sIndex].content.image.description"/>',"</fieldset>","</section>"].join("")}}angular.module("isu-form-sections",["isu.provider","isu.form-init","isu.create-section","isu.sections","isu.templates"]),angular.module("isu.provider",[]).provider("isuSectionProvider",function(){"use strict";this.defaults={serverFramework:"laravel",useDefaultTemplate:!0,method:"POST",target:"/",autopost:!0,fileEndpoint:"/justTheFile/",templateDefaults:null,types:null,possibleTypes:[{type:"Text",html:"<text-section></text-section>",url:"/section/tpl/textSection.tpl.html"},{type:"InlineImage",html:"<inline-image-section></inline-image-section>",url:"/section/tpl/inlinePhotoSection.tpl.html",schema:{image:{file:null,description:null,user_id:null},file_id:null,url:null}},{type:"Profile",html:"<profile-section></profile-section>",url:"/section/tpl/ProfileSection.tpl.html"}]},this.$get=["$http","$q",function(e,t){return{defaults:this.defaults,possibleTypes:function(){return this.defaults.types||this.defaults.possibleTypes.map(function(e){return e.type})},getContentOf:function(e){return this.defaults.possibleTypes.map(function(t){return t.type===e?t.schema||void 0:void 0}).filter(function(e){return!angular.isUndefined(e)})},transformToFormData:function(e){function t(e,n,i){angular.forEach(n,function(n,o){if("object"==typeof n){var r=i+"["+o+"]";n instanceof File&&e.append(r,n),"number"!=typeof o&&"$"===o.charAt(0)||t(e,n,r)}else e.append(i+"["+o+"]",n)})}var n=new FormData;return angular.forEach(e,function(e,i){e&&("object"==typeof e&&0!==Object.keys(e).length?t(n,e,i):("$"!==i.charAt(0)&&"string"==typeof e||"number"==typeof e)&&n.append(i,e))}),n},callMethodToApi:function(n){var i=t.defer(),o=this.transformToFormData(n);return"laravel"===this.defaults.serverFramework&&"PATCH"===this.defaults.method&&(o.append("_method","PATCH"),this.defaults.method="POST"),e({method:this.defaults.method,url:this.defaults.target,data:o||{},transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(e){i.resolve(e)}).error(function(e){console.log(e),i.reject(e)}),i.promise}}}]}),angular.module("isu.create-section",["isu.sections","isu.provider"]).directive("isuCreateSection",["$compile","$interpolate","$timeout","Section","isuSectionProvider",function(e,t,n,i,o){"use strict";function r(e){function t(t,n){if(0>=t&&!n||t+1===r()&&n)return!1;var i=n?1:-1;return e.sections.map(function(e){return e.order==t?e.order=t+i:e.order==t+i&&(e.order=t),e})}function r(){return 0===e.sections.length?0:Math.max.apply(Math,e.sections.map(function(e){return e.order+1}))}function s(t){return angular.isUndefined(t)?!1:(e.sections=e.sections.map(function(n){if(n.order===t){if(e.$emit("removeByOrder",{section:n}),!n.id)return;n._method="DELETE"}return n}).filter(function(e){return!angular.isUndefined(e)}),void c(e.sections))}function c(e){for(var t=e.sort(function(e,t){return e.order>t.order}),n=0,i=0;n<t.length;n++)t[n].hasOwnProperty("_method")&&"DELETE"===t[n]._method?t[n].order=999+n:t[n].order=i++;return e=t}function a(e){for(var t=0;t<e.length;t++)e[t].$getChildScope()&&(e[t].$getChildScope().$sIndex=t);return e}function l(t){angular.forEach(t,function(t,o){t.hasOwnProperty("images")&&(t.content=t.content.map(function(e){for(var n=0;n<t.images.length;n++)t.images[n].file_id==e.file_id&&(e.image=[],e.image.filename=t.images[n].file.filename,e.image.description=t.images[n].file.description);return e})),n(function(){e.$emit("compileSectionToView",{section:i.build(t)})},80)})}e.typeArray=o.possibleTypes(),e.sections=[],e.files=[],this.move=t,this.nextOrderance=r,this.remove=s,this.flattenOrder=c,this.updateScopeIndex=a,this.persistExisting=l}function s(t,n,o,r){t.$watchCollection(function(){return t.sections},function(e){var t=[];if(angular.isArray(e))t=e;else for(var n in e)hasOwnProperty.call(e,n)&&"$"!==n.charAt(0)&&t.push(n);r.flattenOrder(t),r.updateScopeIndex(t)}),t.$watch("create.type",function(e){e&&!angular.isUndefined(e)&&(r.type=null,t.$emit("compileSectionToView",{section:new i(e,r.nextOrderance())}))},!0),t.$on("removeByOrder",function(e,n){e.preventDefault(),n.section.$getChildScope().$destroy(),angular.element(document.getElementById("object-"+n.section.order)).remove(),r.updateScopeIndex(t.sections)}),t.$on("compileSectionToView",function(i,o){if(i.preventDefault(),!o.hasOwnProperty("section"))throw new Error("No section data was provided to compile into DOM.");var r,s,c,a;r=o.section,s=r.$getTemplate(),r.$setChildScope(t.$new()),t.sections.push(r),c=e(s),a=c(r.$getChildScope()),n.append(a)})}return{restrict:"AE",transclude:!0,scope:{sections:"=isuBindSection"},template:["<div ng-transclude></div>",'<md-select ng-model="create.type" placeholder="Add new section">','<md-option ng-value="null">Add new Section</md-option>','<md-option ng-value="type" ng-repeat="type in typeArray">'+t.startSymbol()," type "+t.endSymbol()+" Section</md-option>","</md-select>"].join(""),controllerAs:"create",controller:["$scope",r],link:s}}]),angular.module("isu.create-section").directive("isuEditSection",function(){return{restrict:"A",require:"^isuCreateSection",link:function(e,t,n,i){var o=angular.extend({},e.$eval(n.isuEditSection)),r=JSON.parse(angular.toJson(o));i.persistExisting(r)}}}),angular.module("isu-form-sections").directive("formatHttp",formatHttp),angular.module("isu.form-init",["isu.provider"]).directive("isuSectionInit",["isuSectionProvider",function(e){return{restrict:"A",controller:function(){function e(e,t,i){for(var o=i,r=n(e),s=r.length,c=0;s-1>c;c++){var a=r[c];o[a]||(o[a]={}),o=o[a]}o[r[s-1]]=t}function t(e,t){return n(e)[0]===n(t)[0]}function n(e){return e=e.replace(/\[(.*?)\]/g,".$1"),e=e.replace(/^\./,""),e.split(".")}this.setObject=e,this.matchAttr=t},link:{pre:function(t,n,i){var o=angular.extend([],t.$eval(i.isuSectionTypes));e.defaults.types=o},post:function(t,n,i,o){n.on("submit",function(n){var o=angular.extend({},t.$eval(i.isuSectionInit)),r=angular.extend({},t.$eval(i.isuSectionObject));return o.hasOwnProperty("autopost")&&!o.autopost?!1:(angular.extend(e.defaults,o||{}),void e.callMethodToApi(r).then(function(e){t.$success=e,t.$eval(i.isuSectionSuccess)},function(e){t.$error=e,t.$eval(i.isuSectionError)}))}),n.bind("change",function(e){if(e.preventDefault(),e.target.files){var n=e.target.files[0],r=e.target.getAttribute("ng-model"),s=e.target.name;o.setObject(o.matchAttr(s,r)?i.isuSectionObject+"."+s:r,n,t),t.$apply()}})}}}}]),angular.module("isu-form-sections").directive("textSection",textSection).directive("inlineImageSection",inlineImageSection).directive("profileSection",profileSection),textSection.$inject=["$interpolate"],inlineImageSection.$inject=["$interpolate"],profileSection.$inject=["$interpolate"],angular.module("isu.sections",["isu.templates","isu.provider"]).factory("Section",["TemplateFactory","isuSectionProvider",function(e,t){"use strict";function n(e,t,n){this.type=e,this.order=t,this.content=n||null}function i(e){return-1!==r.indexOf(e)}function o(e,t){angular.forEach(t,function(t,n){e.hasOwnProperty(n)||(e[n]=t)})}n.prototype.$setChildScope=function(e){this.$$childScope=e},n.prototype.$getChildScope=function(){return this.$$childScope},n.prototype.$getTemplate=function(){var n=new e;return t.defaults.useDefaultTemplate?n.$getDefault(this.type):n.$getCustom(this.type)};var r=t.possibleTypes();return n.possibleTypes=angular.copy(r),n.build=function(e){if(i(e.type)){var r=new n(e.type,e.order,e.content||t.getContentOf(e.type));return o(r,e),r}},n}]),angular.module("isu.templates",["isu.provider"]).factory("TemplateFactory",["isuSectionProvider",function(e){"use strict";function t(){this.defaults=e.defaults.possibleTypes}return t.prototype.custom={},t.prototype.$getDefault=function(e){return this.defaults.filter(function(t){return t.type===e?t:void 0}).map(function(e){return e.html||t.retrieveHtml(e.url)})[0]},t.prototype.$setCustom=function(t){var n=e.possibleTypes();n.hasOwnProperty(t.type)||this.defaults.possibleTypes.push(t)},t.prototype.$getCustom=function(e){return this.custom.filter(function(t){return t.type===e?t:void 0}).map(function(e){return e.html||t.retrieveHtml(e.url)})[0]},t.retrieveHtml=function(e){return"<div>Function to retreive HTML</div>"},t.build=function(e){return new t(!e||angular.isUndefined(e)?defaults:e)},t}]);